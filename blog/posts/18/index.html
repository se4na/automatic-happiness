<!DOCTYPE html>

<html amp lang='ja'>
<head>
<link href='https://michilu.com/blog/posts/18/' rel='canonical'>
<meta charset='utf-8'>
<meta content='width=device-width,minimum-scale=1,initial-scale=1' name='viewport'>
<meta content='telephone=no' name='format-detection'>
<script async custom-element='amp-analytics' src='https://cdn.ampproject.org/v0/amp-analytics-0.1.js'></script>
<script async custom-element='amp-list' src='https://cdn.ampproject.org/v0/amp-list-0.1.js'></script>
<script async custom-template='amp-mustache' src='https://cdn.ampproject.org/v0/amp-mustache-0.2.js'></script>
<script async custom-element='amp-fit-text' src='https://cdn.ampproject.org/v0/amp-fit-text-0.1.js'></script>
<script async custom-element='amp-carousel' src='https://cdn.ampproject.org/v0/amp-carousel-0.1.js'></script>
<script async src='https://cdn.ampproject.org/v0.js'></script>
<style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
<title>[Django]: Django FreeComment を使う&middot;ツキヨミチル</title>
<style amp-custom>
body,hr{position:relative}figure,p{padding-bottom:2.4rem}*{border:0;font:inherit;margin:0;padding:0;text-rendering:geometricPrecision}code,kbd,pre,samp{border-radius:2px;overflow-y:hidden;overflow-x:auto}html{box-sizing:border-box;font-size:62.5%;height:100%}@media screen and (min-width:960px){html{font-size:78.125%}}body{box-sizing:border-box;color:#3c3c3d;font-size:1.6rem;line-height:2.4rem;min-height:100%}h1,h2,h3,h4,h5,h6{font-weight:500}h1,h2,h3{line-height:4.8rem;padding:.8rem 0 1.6rem}form,h4,h5,h6{padding:2.4rem 0}h1{font-size:3.6rem}h2{font-size:3.2rem}h3{font-size:2.8rem}h4{font-size:2rem}h5{font-size:1.8rem}h6{font-size:1.6rem}.fs-small,code,kbd,pre,samp,small,sub,sup{font-size:1.2rem}code,kbd,pre,samp{background-color:#efeff0;color:#e528b0;font-family:Consolas,Monaco,"Courier New",monospace;line-height:1}code,kbd,samp{padding:.4rem .4rem .2rem}pre{line-height:2.4rem;padding:1.2rem 1rem;margin:0 0 2.4rem}pre code,pre kbd,pre samp{background-color:transparent;border:none;border-radius:0;padding:0}a:link{color:#4076D4}a:visited{color:#9140D4}a:focus,a:hover{color:#2e68cc}a:active{color:#D44076}img,video{max-width:100%;display:table}hr{height:4.8rem;margin-bottom:2.4rem}hr:before{background-color:#cdcdce;content:'';height:1px;position:absolute;top:50%;width:100%}ol,ul{margin-left:2rem;padding:0 0 2.4rem}ol{list-style-type:decimal}blockquote p:last-child,ol ol,ul ul{padding-bottom:0}ul{list-style-type:disc}cite,dt,em,i,q>q{font-style:italic}dd{padding-left:2rem}blockquote{margin:0 0 2.4rem 1.2rem;border-left:.3rem solid #cdcdce;padding:2.4rem 1.2rem}figure{margin:0 auto}figure img{display:table;margin:0 auto}small,sub,sup{line-height:1}caption,figcaption{font-size:1.2rem;font-style:italic;text-align:center}.ta-left,table th{text-align:left}b,strong,var{font-weight:700}q:after,q:before{content:"'"}.checkbox:before,.checkbox__label:after,.radio:before,.radio__label:after{content:'';margin-top:-10px;position:absolute}abbr,dfn{border-bottom:.1rem dotted #5a5a5b;cursor:default}table{border-radius:2px;border-collapse:separate;border-spacing:0;margin-bottom:2.4rem;width:100%}table th{font-weight:500}table td,table th{padding:0 .6rem}label{color:#7d7d7e}button,input,label,select,textarea{display:block;resize:none;-webkit-appearance:none;-moz-appearance:none}input:-webkit-autofill,select:-webkit-autofill,textarea:-webkit-autofill{color:#3c3c3d;-webkit-text-fill-color:#3c3c3d;-webkit-box-shadow:0 0 0 1000px #fff inset}.checkbox [disabled],.checkbox [disabled]+*,.disabled,.radio [disabled],.radio [disabled]+*,.select [disabled],.select [disabled]+*,.textfield [disabled],.textfield [disabled]+*,[type=button][disabled],[type=submit][disabled],button[disabled]{cursor:default;opacity:.5;pointer-events:none}.smooth{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.f-none{float:none}.f-left{float:left}.f-right{float:right}.clearfix{clear:both;overflow:hidden}.ta-center{text-align:center}.ta-right{text-align:right}.fs-base{font-size:1.6rem}.fs-large{font-size:2rem}.fw-light{font-weight:300}.fw-normal{font-weight:400}.fw-semibold{font-weight:600}.fw-bold{font-weight:700}.btn,[type=button],[type=submit],button{background-color:#E83FB8;border:none;border-radius:.2rem;box-sizing:border-box;color:#fff;cursor:pointer;display:inline-block;height:4.8rem;line-height:4.8rem;max-width:100%;-webkit-transition-property:background-color;transition-property:background-color;-webkit-transition-duration:.2s;transition-duration:.2s;margin:0 auto;padding:0 3rem;text-align:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:auto}.btn:link,.btn:visited,[type=button]:link,[type=button]:visited,[type=submit]:link,[type=submit]:visited,button:link,button:visited{color:#fff;text-decoration:none}.btn:focus,.btn:hover,[type=button]:focus,[type=button]:hover,[type=submit]:focus,[type=submit]:hover,button:focus,button:hover{background-color:#e528b0;color:#fff}.btn:focus,[type=button]:focus,[type=submit]:focus,button:focus{outline:#7d7d7e dotted .1rem}.btn:active,[type=button]:active,[type=submit]:active,button:active{background-color:#E83FB8}.btn--secondary{background-color:#efeff0;color:#3c3c3d}.btn--secondary:link,.btn--secondary:visited{color:#3c3c3d}.btn--secondary:focus,.btn--secondary:hover{background-color:#dededf;color:#3c3c3d}.btn--link,.btn--link:active{background-color:transparent}.btn--secondary:active{color:#7d7d7e}.btn--link,.btn--link:link{color:#4076D4}.btn--link{text-decoration:underline}.btn--link:visited{color:#9140D4}.btn--link:focus,.btn--link:hover{color:#2e68cc;background-color:transparent}.btn--link:active{color:#D44076}.checkbox,.radio{cursor:pointer;display:inline-block;margin-bottom:2.4rem;padding:0 1rem 0 2.25rem;position:relative}.checkbox:before,.radio:before{background-color:#fff;border:2px solid #7d7d7e;height:16px;left:0;top:50%;width:16px}.checkbox input[type=checkbox],.radio input[type=radio]{opacity:0;position:absolute;z-index:-1}.checkbox__label,.radio__label{color:#7d7d7e;font-size:1.2rem;line-height:1}.checkbox__label:after,.radio__label:after{border:1px solid transparent;height:18px;left:0;top:50%;width:18px}.checkbox input[type=checkbox]:focus+.checkbox__label:after,.radio input[type=radio]:focus+.radio__label:after{border-color:#E83FB8;box-shadow:0 1px 2px 1px #dededf inset}.select,.textfield{background-color:#fff;display:block;margin-top:-2px;margin-bottom:2.4rem;position:relative}.select__label,.textfield__label{background-color:#fff;font-size:1.2rem;position:absolute;left:1px;line-height:1;padding:.5rem;right:1px;top:1px}.select select,.textfield input,.textfield textarea{background-color:transparent;border:1px solid #7d7d7e;border-radius:2px;box-sizing:border-box;padding:1.8rem .5rem .6rem;position:relative;width:100%}.select select:focus,.textfield :focus{border-color:#E83FB8;box-shadow:0 1px 2px 0 #dededf inset;outline:0}.radio:before,.radio__label:after{border-radius:20px}.radio input[type=radio]:checked+.radio__label:before{background-color:#e528b0;border-radius:20px;content:'';height:10px;left:5px;margin-top:-5px;position:absolute;top:50%;width:10px}.checkbox:before,.checkbox__label:after{border-radius:2px}.checkbox input[type=checkbox]:checked+.checkbox__label:after{color:#e528b0;content:'\2714';font-size:14px;line-height:18px;text-align:center}.select:after{content:'';border-left:.6rem solid transparent;border-right:.6rem solid transparent;border-top:.6rem solid #7d7d7e;height:0;margin-top:-.5rem;position:absolute;right:1rem;bottom:1.3rem;width:0}.select select{z-index:100}.select option[disabled]{background-color:#efeff0;color:#5a5a5b}.grid{display:-ms-flexbox;display:-webkit-box;display:flex}.grid>*{-ms-flex:1;flex:1;-webkit-box-flex:4;-ms-flex-positive:4;flex-grow:4;padding-left:1rem;padding-right:1rem}.grid>:first-child:not(:last-child){margin-left:-1rem}.grid>:last-child:not(:first-child){margin-right:-1rem}.grid>.column--light{-webkit-box-flex:2;-ms-flex-positive:2;flex-grow:2}.grid>.column--heavy{-webkit-box-flex:8;-ms-flex-positive:8;flex-grow:8}@media (max-width:599px){.grid--medium{display:block}.grid--medium>*{padding-left:0;padding-right:0}.grid--medium>:first-child{margin-left:0}.grid--medium>:last-child{margin-right:0}}@media (max-width:959px){.grid--large{display:block}.grid--large>*{padding-left:0;padding-right:0}.grid--large>:first-child{margin-left:0}.grid--large>:last-child{margin-right:0}}.wrapper{margin:0 auto;max-width:960px;padding:4.8rem 0}.wrapper--large{max-width:1200px;padding:7.2rem 0}.wrapper--small{max-width:640px;padding:2.4rem 0}
.btn--primary{background-color:#3FE8B8}.btn--primary:focus,.btn--primary:hover{background-color:#28e5b0}.btn--primary:active{color:#3FE8B8}.btn--success{background-color:#3FE8B8}.btn--success:focus,.btn--success:hover{background-color:#28e5b0}.btn--success:active{color:#3FE8B8}.btn--info{background-color:#3FB8E8}.btn--info:focus,.btn--info:hover{background-color:#28b0e5}.btn--info:active{color:#3FB8E8}.btn--warning{background-color:#E8B83F}.btn--warning:focus,.btn--warning:hover{background-color:#e5b028}.btn--warning:active{color:#E8B83F}.btn--danger{background-color:#E8633F}.btn--danger:focus,.btn--danger:hover{background-color:#e55028}.btn--danger:active{color:#E8633F}@media only screen and (orientation: portrait){.gsc-results-wrapper-overlay{left:3%;top:2%;width:94%;height:96%;padding:30px 15px 15px}}#navbar-top{position:fixed}#navbar-bottom{max-width:800px;bottom:0}#navbar-top,#navbar-bottom{width:100%;z-index:2;transition-delay:0s,0s;transition-duration:.2s,.2s;transition-timing-function:ease,ease}@media screen and (orientation: landscape){#navbar-top{width:inherit;left:inherit;right:0}}#share-icon{width:100%;margin:0;background:#fff;box-shadow:0 0 1px #767676}#share-icon>a{padding-top:0;padding-bottom:10px;color:#999;text-decoration:none}#share-icon>a:first-child{box-shadow:inset -1.5px 0 0px #f3f3f3;border-radius:0}@media screen and (orientation: landscape){#share-icon>a:first-child{min-width:calc(100vw/6)}}#share-icon>a [class^="icon-"],#share-icon>a [class*=" icon-"]{background-color:#fff}#share-icon>a.share-facebook:hover,#share-icon>a.share-facebook:active,#share-icon>a.share-facebook:focus{color:#3b5998}#share-icon>a.share-twitter:hover,#share-icon>a.share-twitter:active,#share-icon>a.share-twitter:focus{color:#68aade}#share-icon>a.share-line:hover,#share-icon>a.share-line:active,#share-icon>a.share-line:focus{color:#00cf00}#share-icon>a.share-hatena:hover,#share-icon>a.share-hatena:active,#share-icon>a.share-hatena:focus{color:#008fde}#share-icon>a.share-pinterest:hover,#share-icon>a.share-pinterest:active,#share-icon>a.share-pinterest:focus{color:#e60023}body{font-family:Cambria,"Times New Roman",Times,"游明朝体","Yu Mincho",YuMincho,"Hiragino Mincho ProN",serif}header{margin:0;border:0;top:0;left:0;background-color:#4f8ef6;color:#fff}header:nth-of-type(1) amp-img:nth-of-type(1){vertical-align:text-top}header .btn{color:#fff;text-decoration:none;opacity:inherit}header .btn:link,header .btn:visited{color:#fff}@media only screen and (max-width: 693px) and (orientation: portrait){.--first-view{min-height:100vh}}h1:nth-of-type(1){margin-top:0}img{max-width:100%}amp-img[layout='fill']>img[src]{object-fit:cover}amp-img[layout='responsive']>img[src]{object-fit:scale-down}hr{height:0;margin:0;padding:0;border:0;border-top:1px solid rgba(0,0,0,0.1);border-bottom:1px solid #fff}a{color:rgba(0,0,0,0.8)}a:active,a:hover,a:visited{color:rgba(0,0,0,0.8);text-decoration:none}article .--pre-bar-spacer{height:24px}article header .h1,article header .h2,article header .h3,article header .h4,article header .h5,article header .h6,article header h1,article header h2,article header h3,article header h4,article header h5,article header h6,article section .h1,article section .h2,article section .h3,article section .h4,article section .h5,article section .h6,article section h1,article section h2,article section h3,article section h4,article section h5,article section h6{letter-spacing:-0.02em;font-weight:700;margin-left:-1.8px;line-height:1.15;margin-top:40px;margin-bottom:4px}article header .h1,article header .h2,article header h1,article header h2,article section .h1,article section .h2,article section h1,article section h2{font-size:28px}article header .h2,article header h2,article section .h2,article section h2{font-weight:700;margin-top:16px;margin-bottom:6px}article header p,article section p{margin-bottom:30px}article header li,article section li{margin-bottom:15px}article header p,article header li,article section p,article section li{font-size:18px;letter-spacing:.005rem;line-height:1.45;font-weight:400}article .share--btn{padding:0 10px}article .pocket-btn{display:inline-block;height:20px;vertical-align:middle;margin-top:-2px}article amp-ad[type='adsense']{margin-bottom:1rem}article.has-ads .grid>amp-ad{padding:0}@media screen and (orientation: landscape){article.has-ads .grid>amp-ad{max-height:calc(100vh - 48px - 50px)}}@media only screen and (max-width: 693px){article.has-ads .wrapper:nth-child(4) .--pc{display:none}}@media only screen and (min-width: 694px){article.has-ads{display:-webkit-flex;display:-moz-flex;display:-ms-flex;display:-o-flex;display:flex;-webkit-flex-wrap:wrap;-moz-flex-wrap:wrap;-o-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-flex-direction:row-reverse;-moz-flex-direction:row-reverse;-o-flex-direction:row-reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse;-webkit-justify-content:flex-start;-moz-justify-content:flex-start;-o-justify-content:flex-start;-ms-justify-content:flex-start;justify-content:flex-start}article.has-ads .wrapper:nth-child(1),article.has-ads .wrapper:nth-child(3){width:calc(100% - 336px - 2.4rem);margin:0;padding:2.4rem;padding-right:0}article.has-ads .wrapper:nth-child(1){order:-2}article.has-ads .wrapper:nth-child(2){display:none}article.has-ads .wrapper:nth-child(4){order:-1;width:336px;height:0;padding:0;margin-top:48px}article.has-ads .wrapper:nth-child(4) .fs-small{margin-left:.7rem}article.has-ads .wrapper:nth-child(4) .--pc .fs-small{margin-top:calc(100vh - 30px - 48px - 90px)}article.has-ads .wrapper:nth-child(4) .--pc.is-amp .fs-small{margin-top:calc(100vh - 30px - 48px)}}@media only screen and (min-width: 694px) and (orientation: landscape){article.has-ads .wrapper:nth-child(4) .--pc .fs-small{margin-top:calc(100vh - 30px - 90px)}article.has-ads .wrapper:nth-child(4) .--pc.is-amp .fs-small{margin-top:calc(100vh - 30px)}}@media only screen and (min-width: 694px){article.has-ads .wrapper:nth-child(4) amp-ad[type='adsense']{margin-bottom:0}}.share-icon [class^="icon-"],.share-icon [class*=" icon-"]{color:#999;text-decoration:underline;background-color:#fff}.share-icon .icon-share-hatena{color:#008fde}.share-icon .icon-share-hatena:hover,.share-icon .icon-share-hatena:active,.share-icon .icon-share-hatena:focus{color:#008fde}.share-icon .icon-share-pocket{color:#ff004c}.share-icon .icon-share-pocket:hover,.share-icon .icon-share-pocket:active,.share-icon .icon-share-pocket:focus{color:#ff004c}@media only screen and (orientation: portrait){article header .h1,article header .h2,article header .h3,article header .h4,article header .h5,article header .h6,article header h1,article header h2,article header h3,article header h4,article header h5,article header h6,article section .h1,article section .h2,article section .h3,article section .h4,article section .h5,article section .h6,article section h1,article section h2,article section h3,article section h4,article section h5,article section h6{line-height:1.2}article header .h1,article header .h2,article header h1,article header h2,article section .h1,article section .h2,article section h1,article section h2{font-size:26px}article header p,article header li,article section p,article section li{font-size:20px;line-height:1.6}}.embed-responsive-3by1{padding-bottom:30%}.embed-responsive-3by1 .embed-responsive-item{height:auto;margin-top:-16.66666%}.text-muted{color:#777}amp-list>[overflow]{position:absolute;bottom:0}amp-list article{padding-top:.7rem}amp-list article a{text-decoration:none}amp-list article a:link,amp-list article a:visited{color:inherit}amp-list article a>p:nth-child(1){margin-left:1vw;margin-right:2vw}amp-list article a>p:nth-of-type(2){overflow:hidden}amp-list figure{position:relative;width:8em;height:8em;padding-bottom:initial;margin-right:1%}amp-list amp-img{max-width:100%}amp-list amp-img[layout]{margin-start:initial;-webkit-margin-start:initial}amp-list p{margin-left:4vw;margin-right:4vw;font-family:"Helvetica Neue",Helvetica,Arial,"游ゴシック体","Yu Gothic",YuGothic,"Hiragino Kaku Gothic ProN",Meiryo,sans-serif}.explore{width:100vw;top:0;bottom:0;left:-100vw;z-index:3;transition:left ease-in-out .2s}.explore>div{min-height:100vh;position:relative;z-index:2;background-color:#fefefe}.explore amp-carousel{margin:0 auto;max-width:calc((100vh - 48px - 1em)*4/3);max-height:calc(100vh - 48px - 1em)}@media only screen and (min-aspect-ratio: 3 / 4) and (min-height: 768px){.explore amp-carousel{max-width:calc((100vh - 48px - 1em)*4/3/2);max-height:calc((100vh - 48px - 1em)/2)}}.explore amp-carousel amp-fit-text{position:absolute;margin:auto 0 0;max-height:calc(100%*2/3);color:#fefefe;font-weight:600;text-shadow:.5px 1.5px rgba(0,0,0,0.15);z-index:0}.explore amp-carousel amp-fit-text>div:first-of-type{background-image:url('data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4gPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PGxpbmVhckdyYWRpZW50IGlkPSJncmFkIiBncmFkaWVudFVuaXRzPSJvYmplY3RCb3VuZGluZ0JveCIgeDE9IjAuNSIgeTE9IjAuMCIgeDI9IjAuNSIgeTI9IjEuMCI+PHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iIzAwMDAwMCIgc3RvcC1vcGFjaXR5PSIwLjAiLz48c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiMwMDAwMDAiIHN0b3Atb3BhY2l0eT0iMC41NCIvPjwvbGluZWFyR3JhZGllbnQ+PC9kZWZzPjxyZWN0IHg9IjAiIHk9IjAiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9InVybCgjZ3JhZCkiIC8+PC9zdmc+IA==');background-size:100%;background-image:-webkit-gradient(linear, 50% 0%, 50% 100%, color-stop(0%, rgba(0,0,0,0)),color-stop(100%, rgba(0,0,0,0.54)));background-image:-moz-linear-gradient(rgba(0,0,0,0) 0%,rgba(0,0,0,0.54) 100%);background-image:-webkit-linear-gradient(rgba(0,0,0,0) 0%,rgba(0,0,0,0.54) 100%);background-image:linear-gradient(rgba(0,0,0,0) 0%,rgba(0,0,0,0.54) 100%);backdrop-filter:blur(1px)}.explore .next{min-width:100vw;max-width:none;overflow-x:auto}.explore .next amp-list{min-height:0}.explore .next amp-list>[role='list']{position:relative;height:auto;width:auto;min-width:100vw;max-width:none;display:-webkit-flex;display:-moz-flex;display:-ms-flex;display:-o-flex;display:flex;flex-wrap:wrap;-webkit-justify-content:space-between;-moz-justify-content:space-between;-o-justify-content:space-between;-ms-justify-content:space-between;justify-content:space-between}.explore .next amp-list>[role='list']>a[role='listitem']{color:rgba(255,255,255,0.95);margin-top:1px;position:relative;z-index:0;overflow:hidden;-webkit-border-radius:2px;-moz-border-radius:2px;-o-border-radius:2px;-ms-border-radius:2px;border-radius:2px;width:calc((100vw - 2px)/3);height:calc((100vh - 2px)/3)}.explore .next amp-list>[role='list']>a[role='listitem']:active,.explore .next amp-list>[role='list']>a[role='listitem']:hover,.explore .next amp-list>[role='list']>a[role='listitem']:visited{color:rgba(255,255,255,0.95);text-decoration:none}@media only screen and (min-aspect-ratio: 3 / 4){.explore .next amp-list>[role='list']>a[role='listitem']{width:calc((100vw - 2px)/3);height:calc((100vh - 1px)/2)}}.explore .next amp-list>[role='list']>a[role='listitem']:nth-of-type(12n+6),.explore .next amp-list>[role='list']>a[role='listitem']:nth-of-type(12n+9),.explore .next amp-list>[role='list']>a[role='listitem']:nth-of-type(12n+11){margin-top:calc(-1*(100vh - 2px)/3)}@media only screen and (min-aspect-ratio: 3 / 4){.explore .next amp-list>[role='list']>a[role='listitem']:nth-of-type(12n+6),.explore .next amp-list>[role='list']>a[role='listitem']:nth-of-type(12n+9),.explore .next amp-list>[role='list']>a[role='listitem']:nth-of-type(12n+11){margin-top:calc(-1*(100vh - 1px)/2)}}.explore .next amp-list>[role='list']>a[role='listitem']:nth-of-type(12n+5),.explore .next amp-list>[role='list']>a[role='listitem']:nth-of-type(12n+11){width:calc((100vw - 2px)/3*2 + 1px);height:calc((100vh - 2px)/3*2 + 1px)}@media only screen and (min-aspect-ratio: 3 / 4){.explore .next amp-list>[role='list']>a[role='listitem']:nth-of-type(12n+5),.explore .next amp-list>[role='list']>a[role='listitem']:nth-of-type(12n+11){width:calc((100vw - 2px)/3*2 + 1px);height:100vh}}.explore .next amp-list>[role='list']>a[role='listitem']>amp-fit-text{position:absolute;bottom:0;width:100%;max-height:100%;color:#fefefe;font-family:"Helvetica Neue",Helvetica,Arial,"游ゴシック体","Yu Gothic",YuGothic,"Hiragino Kaku Gothic ProN",Meiryo,sans-serif;font-weight:600;text-shadow:.5px 1.5px rgba(0,0,0,0.15)}.explore .next amp-list>[role='list']>a[role='listitem']>amp-fit-text>div:first-of-type{background-image:url('data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4gPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PGxpbmVhckdyYWRpZW50IGlkPSJncmFkIiBncmFkaWVudFVuaXRzPSJvYmplY3RCb3VuZGluZ0JveCIgeDE9IjAuNSIgeTE9IjAuMCIgeDI9IjAuNSIgeTI9IjEuMCI+PHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iIzAwMDAwMCIgc3RvcC1vcGFjaXR5PSIwLjAiLz48c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiMwMDAwMDAiIHN0b3Atb3BhY2l0eT0iMC41NCIvPjwvbGluZWFyR3JhZGllbnQ+PC9kZWZzPjxyZWN0IHg9IjAiIHk9IjAiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9InVybCgjZ3JhZCkiIC8+PC9zdmc+IA==');background-size:100%;background-image:-webkit-gradient(linear, 50% 0%, 50% 100%, color-stop(0%, rgba(0,0,0,0)),color-stop(100%, rgba(0,0,0,0.54)));background-image:-moz-linear-gradient(rgba(0,0,0,0) 0%,rgba(0,0,0,0.54) 100%);background-image:-webkit-linear-gradient(rgba(0,0,0,0) 0%,rgba(0,0,0,0.54) 100%);background-image:linear-gradient(rgba(0,0,0,0) 0%,rgba(0,0,0,0.54) 100%);backdrop-filter:blur(1px)}.explore .next amp-img{background-color:#999}.explore header figure{position:relative;width:48px;height:48px;margin-left:-1rem;padding-bottom:0}.explore amp-img{max-width:100%}.explore amp-img[layout]{margin-start:initial;-webkit-margin-start:initial}.explore amp-img,.explore amp-video,.explore amp-youtube{margin-start:initial;-webkit-margin-start:initial}.explore p{margin-left:4vw;margin-right:4vw}.footer{display:-webkit-flex;display:-moz-flex;display:-ms-flex;display:-o-flex;display:flex;-webkit-justify-content:space-around;-moz-justify-content:space-around;-o-justify-content:space-around;-ms-justify-content:space-around;justify-content:space-around}.footer a{font-size:1.3rem;color:rgba(0,0,0,0.67);text-decoration:none}.footer a:active,.footer a:focus,.footer a:hover{text-decoration:underline}#copyright{color:rgba(0,0,0,0.15);line-height:1.2em;height:1.2em;padding-bottom:.4em;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:-webkit-flex;display:-moz-flex;display:-ms-flex;display:-o-flex;display:flex;-webkit-justify-content:center;-moz-justify-content:center;-o-justify-content:center;-ms-justify-content:center;justify-content:center}#copyright .rtl{direction:rtl;unicode-bidi:bidi-override;overflow:hidden;text-overflow:ellipsis}.bar-bottom{position:absolute;max-width:100vw;min-width:100vw;z-index:-1}html{background-color:#fff}.bar-bottom,.footer-ads-spacer{height:50px}@media only screen and (min-width: 694px){.bar-bottom,.footer-ads-spacer{height:90px}}.footer-chat-spacer{height:50px}@media screen{body,div,article,p{margin:0;padding:0}body{-webkit-text-size-adjust:100%;background-color:#e6e6e6;color:#1b1b1b;-webkit-font-smoothing:subpixel-antialiased;font-size:19px;line-height:30px;text-rendering:optimizeLegibility}body>article{padding-left:4vw;padding-right:4vw}body amp-img,body amp-video,body amp-youtube,body amp-iframe{margin-start:-4vw;-webkit-margin-start:-4vw}}@media only screen and (min-width: 694px){body>article{padding-left:0;padding-right:0}body amp-img,body amp-video,body amp-youtube,body amp-iframe{margin-start:0;-webkit-margin-start:0}}@media screen{body>header,body>article,body>footer{max-width:800px;margin-left:auto;margin-right:auto;text-align:start;word-wrap:break-word}body>article,body>footer{position:relative;background-color:#fbfbfb}body div,body p,body a{max-width:100%}body amp-img{width:100vw}body amp-img img{min-width:100vw}body amp-video,body amp-youtube,body amp-iframe{width:100vw}body video{width:100vw;height:auto;position:relative}}@media only screen and (min-width: 694px){body{margin:0 auto}body amp-img,body amp-video,body amp-youtube,body amp-iframe{width:initial}body img{min-width:initial}body>article,body>footer{box-shadow:0 12px 12px 3px rgba(0,0,0,0.2)}}@font-face{font-family:'siphandon';src:url("/fonts/siphandon.ttf?9zhtrx") format("truetype"),url("/fonts/siphandon.woff?9zhtrx") format("woff"),url("/fonts/siphandon.svg?9zhtrx#siphandon") format("svg");font-weight:normal;font-style:normal}.icon-explore,.icon-map,.icon-notifications,.icon-search{font-family:'siphandon';speak:none;font-style:normal;font-weight:normal;font-variant:normal;text-transform:none;line-height:1;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-explore:before{content:"🌍"}.icon-map:before{content:"🗺"}.icon-notifications:before{content:"🔔"}.icon-search:before{content:"🔍"}/*!
 ** @package IcoFont
 ** @version 1.0.1
 ** @author IcoFont https://icofont.com
 ** @copyright Copyright (c) 2015 - 2020 IcoFont
 ** @license - https://icofont.com/license/ */@font-face{font-family:"IcoFont";font-weight:normal;font-style:"Regular";src:url("/fonts/20201223.woff2") format("woff2"),url("/fonts/20201223.woff") format("woff")}[class^="icofont-"],[class*=" icofont-"]{font-family:"IcoFont";speak:none;font-style:normal;font-weight:normal;font-variant:normal;text-transform:none;white-space:nowrap;word-wrap:normal;direction:ltr;line-height:1;-webkit-font-feature-settings:"liga";-webkit-font-smoothing:antialiased}.icofont-pinterest:before{content:""}.icofont-xs{font-size:.5em}.icofont-sm{font-size:.75em}.icofont-md{font-size:1.25em}.icofont-lg{font-size:1.5em}.icofont-1x{font-size:1em}.icofont-2x{font-size:2em}.icofont-3x{font-size:3em}.icofont-4x{font-size:4em}.icofont-5x{font-size:5em}.icofont-6x{font-size:6em}.icofont-7x{font-size:7em}.icofont-8x{font-size:8em}.icofont-9x{font-size:9em}.icofont-10x{font-size:10em}.icofont-fw{text-align:center;width:1.25em}.icofont-ul{list-style-type:none;padding-left:0;margin-left:0}.icofont-ul>li{position:relative;line-height:2em}.icofont-ul>li .icofont{display:inline-block;vertical-align:middle}.icofont-border{border:solid .08em #f1f1f1;border-radius:.1em;padding:.2em .25em .15em}.icofont-pull-left{float:left}.icofont-pull-right{float:right}.icofont.icofont-pull-left{margin-right:.3em}.icofont.icofont-pull-right{margin-left:.3em}.icofont-spin{-webkit-animation:icofont-spin 2s infinite linear;animation:icofont-spin 2s infinite linear;display:inline-block}.icofont-pulse{-webkit-animation:icofont-spin 1s infinite steps(8);animation:icofont-spin 1s infinite steps(8);display:inline-block}@-webkit-keyframes icofont-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes icofont-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}.icofont-rotate-90{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=1)";-webkit-transform:rotate(90deg);transform:rotate(90deg)}.icofont-rotate-180{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=2)";-webkit-transform:rotate(180deg);transform:rotate(180deg)}.icofont-rotate-270{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=3)";-webkit-transform:rotate(270deg);transform:rotate(270deg)}.icofont-flip-horizontal{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=0, mirror=1)";-webkit-transform:scale(-1, 1);transform:scale(-1, 1)}.icofont-flip-vertical{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)";-webkit-transform:scale(1, -1);transform:scale(1, -1)}.icofont-flip-horizontal.icofont-flip-vertical{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)";-webkit-transform:scale(-1, -1);transform:scale(-1, -1)}:root .icofont-rotate-90,:root .icofont-rotate-180,:root .icofont-rotate-270,:root .icofont-flip-horizontal,:root .icofont-flip-vertical{-webkit-filter:none;filter:none;display:inline-block}.icofont-inverse{color:#fff}.sr-only{border:0;clip:rect(0, 0, 0, 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px}.sr-only-focusable:active,.sr-only-focusable:focus{clip:auto;height:auto;margin:0;overflow:visible;position:static;width:auto}@font-face{font-family:'style';src:url("/fonts/style.ttf?225wom") format("truetype"),url("/fonts/style.woff?225wom") format("woff"),url("/fonts/style.svg?225wom#style") format("svg");font-weight:normal;font-style:normal}.icon-share-google,.icon-feedly,.icon-share-pocket,.icon-share-line,.icon-share-hatena,.icon-share-facebook,.icon-share-twitter,.icon-notifications,.icon-search{font-family:'style';speak:none;font-style:normal;font-weight:normal;font-variant:normal;text-transform:none;line-height:1;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-share-google:before{content:"🔗"}.icon-feedly:before{content:"🔥"}.icon-share-pocket:before{content:"📑"}.icon-share-line:before{content:"💬"}.icon-share-hatena:before{content:"❔"}.icon-share-facebook:before{content:"🗣"}.icon-share-twitter:before{content:"🐦"}.icon-notifications:before{content:"🔔"}.icon-search:before{content:"🔍"}


article[data-src='https://michilu.com/blog/posts/18/']{display:none}
</style>
<script type='application/ld+json'>{"publisher": {"logo": {"url": "https://michilu.com/img/apple-touch-icon-180x.png", "width": 60, "@type": "ImageObject", "height": 60}, "@type": "Organization", "name": "Site Author:"}, "author": {"@type": "Person", "name": "Site Author:"}, "headline": "[Django]: Django FreeComment \u3092\u4f7f\u3046&amp;mdash;", "image": {"url": "https://michilu.com/img/apple-touch-icon-180x.png", "width": 700, "@type": "ImageObject", "height": 470}, "datePublished": "2007-02-08T19:59:00+09:00", "@type": "BlogPosting", "mainEntityOfPage": "https://michilu.com/blog/posts/18/", "@context": "http://schema.org", "dateModified": "2007-02-08T20:04:10+09:00"}</script>

<meta content='🌝ﾂｷﾖﾐﾁﾙ' name='apple-mobile-web-app-title'>


<meta content='ツキヨミチル' itemprop='name'>
<meta content='ツキヨミチル' property='og:site_name'>

<meta content='article' property='og:type'>
<meta content='[Django]: Django FreeComment を使う' property='og:title'>

<meta content='https://michilu.com/blog/posts/18/' property='og:url'>
<meta content="[Django]: Django FreeComment を使う" property='og:description'>

<meta content='https://michilu.com/img/apple-touch-icon-200x.png' property='og:image'>



<link href='/manifest.json' rel='manifest'>

<link href='/img/apple-touch-icon-180x.png' rel='apple-touch-icon' sizes='180x180'>
<link href='/img/apple-touch-icon-180x.png' rel='apple-touch-icon-precomposed'>
<link href='/img/apple-touch-icon-180x.png' rel='shortcut icon'>
<link href='/img/apple-touch-icon-192x.png' rel='icon' sizes='192x192'>
</head>
<body>
<amp-analytics type='googleanalytics'>
<script type='application/json'>{"requests": {"scrollEvent": "${host}/debug/collect?${basePrefix}&t=event\n&ec=${eventCategory}&ea=${eventAction}&el=${eventLabel}&ev=${eventValue}\n&ni=${ni}\n${baseSuffix}", "scrollTiming": "${host}/debug/collect?${basePrefix}&t=timing\n&utc=${timingCategory}&utv=${timingVar}&utt=${timingValue}&utl=${timingLabel}\n${baseSuffix}"}, "vars": {"account": null}, "triggers": {"trackPageview": {"on": "visible", "request": "pageview"}, "scrollPercentage": {"on": "scroll", "request": "scrollEvent", "vars": {"ni": true, "account": null, "eventLabel": "${verticalScrollBoundary}%", "eventValue": 1, "eventCategory": "Scroll Depth", "eventAction": "Percentage"}, "scrollSpec": {"verticalBoundaries": [0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100]}}, "scrollPixel": {"on": "scroll", "request": "scrollEvent", "vars": {"ni": true, "account": null, "eventLabel": "${scrollTop}", "eventValue": 1, "eventCategory": "Scroll Depth", "eventAction": "Pixel Depth"}, "scrollSpec": {"verticalBoundaries": [0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100]}}, "scrollTiming": {"on": "scroll", "request": "scrollTiming", "vars": {"timingCategory": "Scroll Depth", "timingValue": "${totalEngagedTime}000", "timingLabel": "${verticalScrollBoundary}%", "timingVar": "Percentage", "account": null}, "scrollSpec": {"verticalBoundaries": [0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100]}}}}</script>
</amp-analytics>
<header class='grid' id='navbar-top'>
<div class='column--heavy grid' id='share-icon'>
<a class='btn btn--link visible-xs-inline-block' href='/'>
<span aria-hidden='true' class='icon-map'></span>
</a>
<a class='btn btn--link share-line visible-xs-inline-block' href='https://line.me/R/msg/text/?[Django]: Django FreeComment を使う https://michilu.com/blog/posts/18/' target='_blank' title='LINEで送る'>
<span aria-hidden='true' class='icon-share-line'></span>
</a>
<a class='btn btn--link share-hatena' href='http://b.hatena.ne.jp/add?mode=confirm&amp;url=https://michilu.com/blog/posts/18/' rel='noopener' target='_blank' title='はてブに追加する'>
<span aria-hidden='true' class='icon-share-hatena'></span>
</a>
<a class='btn btn--link share-twitter' href='https://twitter.com/share?u=https://michilu.com/blog/posts/18/&amp;text=[Django]: Django FreeComment を使う' rel='noopener' target='_blank' title='Twitterにツイートする'>
<span aria-hidden='true' class='icon-share-twitter'></span>
</a>
<a class='btn btn--link share-facebook' href='https://www.facebook.com/share.php?u=https://michilu.com/blog/posts/18/' rel='noopener' target='_blank' title='Facebookでシェアする'>
<span aria-hidden='true' class='icon-share-facebook'></span>
</a>
<a class='btn btn--link share-pinterest' href='https://www.pinterest.com/pin/create/button/?url=https://michilu.com/blog/posts/18/' rel='noopener' target='_blank' title='Pinterestに保存する'>
<span aria-hidden='true' class='icofont-pinterest'></span>
</a>
</div>
</header>

<article class=''>

<div class='wrapper wrapper--small'>

<div class='--pre-bar-spacer grid'>
<div class='btn btn--link disabled'>&#8203;</div>
</div>
<section>

<h1>[Django]: Django FreeComment を使う</h1>


<p>Django 製ブログアプリに、 Comment 機能を組み込んでみます。 (Django 0.96-pre, Revision: 4342)</p>
<p>INDEX</p>
<blockquote>
<ol class="arabic simple">
<li><a class="reference internal" href="#id1">ライブラリをインクルードする。</a></li>
<li><a class="reference internal" href="#comment-counts">Comment Counts を表示してみる。</a></li>
<li><a class="reference internal" href="#comment">エントリーページで、 Comment リストを表示してみる。</a></li>
<li><a class="reference internal" href="#freecomment">FreeComment 書き込みフォームを組み込む。</a></li>
<li><a class="reference internal" href="#free-comment-form">{% free_comment_form %} レンダリングの仕組み</a></li>
<li><a class="reference internal" href="#freecomment-post">FreeComment POST の処理</a></li>
<li><a class="reference internal" href="#id2">スパム対策関連</a></li>
</ol>
</blockquote>
<dl class="docutils">
<dt>see: <a class="reference external" href="http://code.djangoproject.com/wiki/UsingFreeComment">Using Django's Free Comments</a> :</dt>
<dd><a class="reference external" href="http://code.djangoproject.com/wiki/UsingFreeComment">http://code.djangoproject.com/wiki/UsingFreeComment</a></dd>
</dl>
<div class="section" id="id1">
<h1>ライブラリをインクルードする。</h1>
<p><strong>myproject/settings.py</strong></p>
<pre class="code python literal-block">
INSTALLED_APPS = (
    ...
    'django.contrib.comments',
    ...
)
</pre>
<p>これで FreeComment を使うための下準備ができたはず。</p>
</div>
<div class="section" id="comment-counts">
<h1>Comment Counts を表示してみる。</h1>
<p>まず手始めに、 Comment のカウント数(コメント書き込み数)をブログの INDEX ページに表示させてみます。 INDEX テンプレートファイル内の、 <cite>{% load comments.comments %}</cite> でライブラリを読み込みます。</p>
<p><strong>myproject/templates/blog/index.html</strong></p>
<pre class="code django literal-block">
{% load comments.comments %}
...
{% block content %}
    {% for object in object_list %}
        {{ object.title }}
        {{ object.add_date|date:&quot;r&quot; }}
        {% get_free_comment_count for blog.entry object.id as comment_count %}
        {{ comment_count }}
    {% endfor %}
{% endblock %}
...
</pre>
<p>試しに、 development server にアクセスしてみる。</p>
<p><a class="reference external" href="http://127.0.0.1:8000/">http://127.0.0.1:8000/</a></p>
<pre class="code text literal-block">
OperationalError at /
no such table: comments_freecomment
</pre>
<p>Internal Server Error になります。 <cite>comments_freecomment</cite> なんていう Database Table は無い、とのことなので syncdb します。</p>
<pre class="code bash literal-block">
$ python manage.py syncdb
Creating table comments_comment
Creating table comments_freecomment
Creating table comments_karmascore
Creating table comments_moderatordeletion
Creating table comments_userflag
Installing index for comments.Comment model
Installing index for comments.FreeComment model
Installing index for comments.KarmaScore model
Installing index for comments.ModeratorDeletion model
Installing index for comments.UserFlag model
</pre>
<p>comments_comment, comments_freecomment, comments_karmascore, comments_moderatordeletion, comments_userflag が自動作成されました。</p>
<p>管理画面で確認してみる。</p>
<p><a class="reference external" href="http://127.0.0.1:8000/admin/">http://127.0.0.1:8000/admin/</a></p>
<p>Site administration:</p>
<pre class="literal-block">
+------------------------------+
| Comments                     |
+---------------+-----+--------+
| Comments      | Add | Change |
+---------------+-----+--------+
| Free comments | Add | Change |
+---------------+-----+--------+
</pre>
</div>
<div class="section" id="comment">
<h1>エントリーページで、 Comment リストを表示してみる。</h1>
<p>エントリーのテンプレートに、 コメントリストを表示するためのタグを埋め込みます。</p>
<p><strong>myproject/templates/blog/entry.html</strong></p>
<pre class="code django literal-block">
{% load comments.comments %}
...

{% block content %}
    {{ object.content }}
    {{ object.add_date|date:&quot;r&quot; }}
    {% get_free_comment_list for blog.entry object.id as comment_list %}
    {{ comment_list }}
{% endblock %}
</pre>
<p><cite>comment_list</cite> はリストオブジェクトなので、 そのままリストが表示されます。 <strong>for</strong> で回して整形します。</p>
<p><strong>myproject/templates/blog/entry.html</strong></p>
<pre class="code django literal-block">
{% load comments.comments %}
...

{% block content %}
    {{ object.content }}
    {{ object.add_date|date:&quot;r&quot; }}
    {% get_free_comment_list for blog.entry object.id as comment_list %}
    {% for comment in comment_list %}
            &lt;div class=&quot;comment&quot; id=&quot;c{{ comment.id }}&quot;&gt;
                &lt;h3&gt;
                            {{ comment.id }}.
                            {{ comment.person_name }}
                             : [{{ comment.submit_date|date:&quot;r&quot; }}]
                            &lt;a href=&quot;#c{{ comment.id }}&quot;&gt;¶&lt;/a&gt;
                &lt;/h3&gt;
                {{ comment.comment|escape|urlizetrunc:&quot;40&quot;|linebreaks }}
            &lt;/div&gt;
    {% endfor %}
{% endblock %}
</pre>
</div>
<div class="section" id="freecomment">
<h1>FreeComment 書き込みフォームを組み込む。</h1>
<p>コメント書き込みフォームを表示したい場所に、 <strong>{% free_comment_form %}</strong> を挿入します。</p>
<p><strong>myproject/templates/blog/entry.html</strong></p>
<pre class="code django literal-block">
{% load comments.comments %}
...

{% block content %}
    ...

    {% free_comment_form for blog.entry object.id %}

{% endblock %}
</pre>
<p>以下は、デフォルトテンプレート (<strong>django/contrib/comments/templates/comments/freeform.html</strong>) で出力される HTML です。</p>
<pre class="code html literal-block">
&lt;form action=&quot;/comments/postfree/&quot; method=&quot;post&quot;&gt;
&lt;p&gt;&lt;label for=&quot;id_person_name&quot;&gt;Your name:&lt;/label&gt; &lt;input type=&quot;text&quot; id=&quot;id_person_name&quot; name=&quot;person_name&quot; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;label for=&quot;id_comment&quot;&gt;Comment:&lt;/label&gt;&lt;br /&gt;&lt;textarea name=&quot;comment&quot; id=&quot;id_comment&quot; rows=&quot;10&quot; cols=&quot;60&quot;&gt;&lt;/textarea&gt;&lt;/p&gt;
&lt;p&gt;
&lt;input type=&quot;hidden&quot; name=&quot;options&quot; value=&quot;ip&quot; /&gt;
&lt;input type=&quot;hidden&quot; name=&quot;target&quot; value=&quot;9:17&quot; /&gt;
&lt;input type=&quot;hidden&quot; name=&quot;gonzo&quot; value=&quot;99104bbd35c7c2e05d6db3d315374066&quot; /&gt;
&lt;input type=&quot;submit&quot; name=&quot;preview&quot; value=&quot;Preview comment&quot; /&gt;
&lt;/p&gt;
&lt;/form&gt;
</pre>
<pre class="code django literal-block">
...
&lt;input type=&quot;hidden&quot; name=&quot;options&quot; value=&quot;{{ options }}&quot; /&gt;
&lt;input type=&quot;hidden&quot; name=&quot;target&quot; value=&quot;{{ target }}&quot; /&gt;
&lt;input type=&quot;hidden&quot; name=&quot;gonzo&quot; value=&quot;{{ hash }}&quot; /&gt;
&lt;input type=&quot;submit&quot; name=&quot;preview&quot; value=&quot;{% trans &quot;Preview comment&quot; %}&quot; /&gt;
...
</pre>
<p><strong>/comments/postfree/</strong> に各パラメータをPOSTするようになっています。 すべて必須です。</p>
<blockquote>
<ul class="simple">
<li>person_name  : ハンドルネーム</li>
<li>comments     : コメント内容</li>
<li>options      : &quot;ip&quot;</li>
<li><dl class="first docutils">
<dt>target <span class="classifier-delimiter">:</span> <span class="classifier">&lt;ContentType_id:Object_id&gt;形式(ここでは&lt;blog.entry:entry_id&gt;)で、ポスト先対象を指定します。</span></dt>
<dd>ContentType: django.contrib.contenttypes.models.ContentType</dd>
</dl>
</li>
<li>gonzo        : security_hash</li>
<li>preview      : &quot;Preview comment&quot;</li>
</ul>
</blockquote>
<p>カスタマイズしたい場合は、 <strong>myproject/templates/comments/freeform.html</strong> にテンプレートを配置します。</p>
<p>さて、フォームからコメントをポストしてみます。</p>
<pre class="code text literal-block">
Page not found (404)
Request Method:     POST
Request URL:        http://127.0.0.1:8000/comments/postfree/
</pre>
<p>フォームのPOST先URLである <strong>/comments/postfree/</strong> にマッチするものがない、というエラーです。  <cite>urls.py</cite> でポスト先のURLを登録します。</p>
<p><strong>myroject/urls.py</strong></p>
<pre class="code python literal-block">
...
urlpatterns += patterns('',
    ...

    (r'^comments/', include('django.contrib.comments.urls.comments')),
)
...
</pre>
<p>もう一度、フォームからコメントをポストしてみます。</p>
<pre class="code text literal-block">
TemplateDoesNotExist at /comments/postfree/
comments/free_preview.html

Request Method:     POST
Request URL:        http://127.0.0.1:8000/comments/postfree/
</pre>
<p>今度は、 コメントポスト後に表示されるプレビュー(書き込み内容の確認画面)のテンプレートがない、というエラーです。 <strong>comments/free_preview.html</strong> を配置します。</p>
<pre class="code bash literal-block">
$ mkdir templates/comments
$ touch templates/comments/free_preview.html
</pre>
<p><strong>myproject/templates/comments/free_preview.html</strong></p>
<pre class="code django literal-block">
{% extends &quot;blog/base.html&quot; %}
{% block content %}
&lt;h1&gt;Preview your comment&lt;/h1&gt;

&lt;form action=&quot;../postfree/&quot; method=&quot;post&quot;&gt;
    {% if comment_form.has_errors %}
        &lt;p&gt;&lt;strong style=&quot;color: red;&quot;&gt;Please correct the following errors.&lt;/strong&gt;&lt;/p&gt;
    {% else %}
    &lt;hr /&gt;
        &lt;div class=&quot;comment&quot;&gt;
                    {{ comment.person_name }}
                     : [{{ comment.submit_date|date:&quot;r&quot; }}]
                {{ comment.comment|escape|urlizetrunc:&quot;40&quot;|linebreaks }}
        &lt;/div&gt;
    &lt;hr /&gt;

        &lt;p&gt;&lt;input type=&quot;submit&quot; name=&quot;post&quot; value=&quot;Post public comment&quot; /&gt;&lt;/p&gt;

        &lt;h1&gt;Or edit it again&lt;/h1&gt;
    {% endif %}

    {% if comment_form.person_name.errors %}
        {{ comment_form.person_name.html_error_list }}
    {% endif %}

    &lt;p&gt;&lt;label for=&quot;id_person_name&quot;&gt;Your name:&lt;/label&gt; {{ comment_form.person_name }}&lt;/p&gt;

    {% if comment_form.comment.errors %}
            {{ comment_form.comment.html_error_list }}
    {% endif %}

    &lt;p&gt;
            &lt;label for=&quot;id_comment&quot;&gt;Comment:&lt;/label&gt;
            &lt;br /&gt;
            {{ comment_form.comment }}
    &lt;/p&gt;

    &lt;input type=&quot;hidden&quot; name=&quot;options&quot; value=&quot;{{ options }}&quot; /&gt;
    &lt;input type=&quot;hidden&quot; name=&quot;target&quot; value=&quot;{{ target }}&quot; /&gt;
    &lt;input type=&quot;hidden&quot; name=&quot;gonzo&quot; value=&quot;{{ hash }}&quot; /&gt;

    &lt;p&gt;
            &lt;input type=&quot;submit&quot; name=&quot;preview&quot; value=&quot;Preview revised comment&quot; /&gt;
    &lt;/p&gt;
&lt;/form&gt;
{% endblock %}
</pre>
<p>以下の部分は Validate Error があった場合に表示されます。</p>
<pre class="code django literal-block">
...
    {% if comment_form.has_errors %}
        &lt;p&gt;&lt;strong style=&quot;color: red;&quot;&gt;Please correct the following errors.&lt;/strong&gt;&lt;/p&gt;
    {% else %}
    ...
    {% if comment_form.person_name.errors %}
        {{ comment_form.person_name.html_error_list }}
    {% endif %}
    ...
    {% if comment_form.comment.errors %}
            {{ comment_form.comment.html_error_list }}
    {% endif %}
    ...
</pre>
<p>もう一度！ フォームからコメントをポストしてみます。</p>
<pre class="code text literal-block">
TemplateDoesNotExist at /comments/posted/
comments/posted.html

Request Method:     GET
Request URL:        http://127.0.0.1:8000/comments/posted/
</pre>
<p>コメントプレビューの次のステップである書き込み完了画面のテンプレートがない、というエラーです。 エラーは表示されますがコメントは保存されています。</p>
<p><a class="reference external" href="http://127.0.0.1:8000/admin/comments/freecomment/">http://127.0.0.1:8000/admin/comments/freecomment/</a></p>
<p>Select free comment to change:</p>
<pre class="literal-block">
+---------------+-------------------------+--------------+----------------+
| Person's name | Date/time submitted     | Content type | Content object |
+---------------+-------------------------+--------------+----------------+
| tester        | Feb. 3, 2007, 5:23 p.m. | entry        | てすと         |
+---------------+-------------------------+--------------+----------------+
|1 free comment                                                           |
+-------------------------------------------------------------------------+
</pre>
<p><strong>comments/posted.html</strong> を配置します。</p>
<pre class="code bash literal-block">
$ touch templates/comments/posted.html
</pre>
<p><strong>myproject/templates/comments/posted.html</strong></p>
<pre class="code django literal-block">
{% extends &quot;blog/base.html&quot; %}

{% block content %}
&lt;h1&gt;Comment posted successfully&lt;/h1&gt;

&lt;p&gt;Thanks for contributing.&lt;/p&gt;

{% if object %}
    &lt;ul&gt;
            &lt;li&gt;&lt;a href=&quot;{{ object.get_absolute_url }}#comments&quot;&gt;View your comment&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
{% endif %}
&lt;hr /&gt;
{% endblock %}
</pre>
<p>このような感じで。 さぁ、もう一度コメントをポストしてみましょう。 今度はエラーが出ずに成功するはずです。 :-)</p>
<p>ここまでで一通り完成です。 さらにハックしたい場合は <a class="reference external" href="http://www.b-list.org/weblog/2006/07/16/django-tips-hacking-freecomment">The B-List: Django tips: Hacking FreeComment</a> をどうぞ！</p>
</div>
<div class="section" id="free-comment-form">
<h1>{% free_comment_form %} レンダリングの仕組み</h1>
<p>テンプレートタグ <strong>{% free_comment_form %}</strong> は、 <cite>django/contrib/comments/templatetags/comments.py</cite> で <strong>DoCommentForm(True)</strong> に割り当てられています。</p>
<p><strong>django.contrib.comments.templatetags.comments.DoCommentForm</strong></p>
<pre class="code python literal-block">
class DoCommentForm:
    &quot;&quot;&quot;
    Displays a comment form for the given params.

    Syntax::

        {% comment_form for [pkg].[py_module_name] [context_var_containing_obj_id] with [list of options] %}

    Example usage::

        {% comment_form for lcom.eventtimes event.id with is_public yes photos_optional thumbs,200,400 ratings_optional scale:1-5|first_option|second_option %}

    ``[context_var_containing_obj_id]`` can be a hard-coded integer or a variable containing the ID.
    &quot;&quot;&quot;
    def __init__(self, free):
        self.free = free

    ...

    return CommentFormNode(content_type, obj_id_lookup_var, obj_id, self.free, **kwargs)
</pre>
<p><cite>self.free</cite> は bool で <strong>Comment</strong> (False) あるいは <strong>FreeComment</strong> (True) であるかを示します。 最終的に <strong>CommentFormNode</strong> を返します。 <cite>Example usage</cite> にあるように <cite>CommentFormNode</cite> へパラメータを渡すことができます。</p>
<p><strong>django.contrib.comments.templatetags.comments.CommentFormNode</strong></p>
<pre class="code python literal-block">
class CommentFormNode(template.Node):
    def __init__(self, content_type, obj_id_lookup_var, obj_id, free,
        photos_optional=False, photos_required=False, photo_options='',
        ratings_optional=False, ratings_required=False, rating_options='',
        is_public=True):
    ...
</pre>
<p>FreeComment Form 内の {{ hash }} は、 <cite>Comment.objects.get_security_hash()</cite> によって生成されます。</p>
<p><strong>django.contrib.comments.models.CommentManager</strong></p>
<pre class="code python literal-block">
class CommentManager(models.Manager):
    def get_security_hash(self, options, photo_options, rating_options, target):
        &quot;&quot;&quot;
        Returns the MD5 hash of the given options (a comma-separated string such as
        'pa,ra') and target (something like 'lcom.eventtimes:5157'). Used to
        validate that submitted form options have not been tampered-with.
        &quot;&quot;&quot;
        import md5
        return md5.new(options + photo_options + rating_options + target + settings.SECRET_KEY).hexdigest()
</pre>
</div>
<div class="section" id="freecomment-post">
<h1>FreeComment POST の処理</h1>
<p><cite>myproject/urls.py</cite> で <cite>r'^comments/'</cite> に <cite>django.contrib.comments.urls.comments</cite> が割り当てられました。</p>
<p><strong>django.contrib.comments.urls.comments</strong></p>
<pre class="code python literal-block">
from django.conf.urls.defaults import *

urlpatterns = patterns('django.contrib.comments.views',
    (r'^post/$', 'comments.post_comment'),
    (r'^postfree/$', 'comments.post_free_comment'),
    (r'^posted/$', 'comments.comment_was_posted'),
    (r'^karma/vote/(?P&lt;comment_id&gt;\d+)/(?P&lt;vote&gt;up|down)/$', 'karma.vote'),
    (r'^flag/(?P&lt;comment_id&gt;\d+)/$', 'userflags.flag'),
    (r'^flag/(?P&lt;comment_id&gt;\d+)/done/$', 'userflags.flag_done'),
    (r'^delete/(?P&lt;comment_id&gt;\d+)/$', 'userflags.delete'),
    (r'^delete/(?P&lt;comment_id&gt;\d+)/done/$', 'userflags.delete_done'),
)
</pre>
<p><cite>/comments/postfree/</cite> は、 <cite>django.contrib.comments.views.comments.post_free_comment()</cite> で処理されます。 Validate Error となるか <cite>request.POST[&quot;preview&quot;]</cite> がある場合は、 テンプレート <cite>comments/free_preview.html</cite> でレンダリングされてレスポンスが返ります。 Validate Error 、 <cite>request.POST[&quot;preview&quot;]</cite> が無く、且つ <cite>request.POST[&quot;post&quot;]</cite> がある場合に、コメントは保存されて <strong>&quot;../posted/?c=&lt;content_type_id&gt;:&lt;object_id&gt;&quot;</strong> へリダイレクトされます。 これ以外の場合は &quot;404:Not Found&quot; が返ります。</p>
<p><cite>/comments/posted/</cite> は、 <cite>django.contrib.comments.views.comments.comment_was_posted()</cite> で処理されます。 request.GET[&quot;c&quot;] (&lt;content_type_id&gt;:&lt;object_id&gt;) がある場合には、そのオブジェクトを取得し &quot;object&quot; としてテンプレート <cite>comments/posted.html</cite> に渡されます。</p>
<p>コメントは、 &quot;person_name&quot; が <cite>maxlength=50</cite> 、 &quot;comment&quot; が <cite>maxlength=3000</cite> です。 超過する場合は、 Manipulator が検出し Validate Error が返されます。</p>
<p>POSTされたコメントは、POST対象オブジェクトへのコメントで重複した内容かあるかチェックされます。 同一の内容がある場合は新規に保存はされず、既に保存されているオブジェクトが返ります。</p>
<p><strong>django.contrib.comments.views.comments.PublicFreeCommentManipulator</strong></p>
<pre class="code python literal-block">
class PublicFreeCommentManipulator(forms.Manipulator):
    ...

    def save(self, new_data):
        today = datetime.date.today()
        c = self.get_comment(new_data)
        # Check that this comment isn't duplicate. (Sometimes people post
        # comments twice by mistake.) If it is, fail silently by pretending
        # the comment was posted successfully.
        for old_comment in FreeComment.objects.filter(content_type__id__exact=new_data[&quot;content_type_id&quot;],
            object_id__exact=new_data[&quot;object_id&quot;], person_name__exact=new_data[&quot;person_name&quot;],
            submit_date__year=today.year, submit_date__month=today.month,
            submit_date__day=today.day):
            if old_comment.comment == c.comment:
                return old_comment
        c.save()
        return c
</pre>
</div>
<div class="section" id="id2">
<h1>スパム対策関連</h1>
<p><cite>/comments/postfree/</cite> ( <cite>django.contrib.comments.views.comments.post_free_comment()</cite> )では、 request.META[&quot;REMOTE_ADDR&quot;] がチェックされ <cite>settings.BANNED_IPS</cite> のリストに存在する場合は、 request.POST と request.META の内容が &quot;subject:Practical joker&quot; として settings.ADMINS へメール送信されます。 コメントは保存されませんが同様に &quot;../posted/?c=&lt;content_type_id&gt;:&lt;object_id&gt;&quot; へリダイレクトされます。</p>
<hr class="docutils" />
<p><a class="reference external" href="http://MiCHiLU.com/blog/posts/18/">http://MiCHiLU.com/blog/posts/18/</a></p>
<blockquote>
<ul class="simple">
<li>Added at         Thu, 8 Feb 2007 19:59:00 +0900</li>
<li>Last modified at Thu, 8 Feb 2007 20:04:10 +0900</li>
</ul>
</blockquote>
<p>This work is licensed under a Creative Commons Attribution-Noncommercial-Share Alike 2.1 Japan License.
<a class="reference external" href="http://creativecommons.org/licenses/by-nc-sa/2.1/jp/">http://creativecommons.org/licenses/by-nc-sa/2.1/jp/</a></p>
</div>

<p>
author:




<br>
Posted on
<time datetime='2007-02-08T19:59:00+09:00'>2007-2-8</time>


<br>
Updated on
<time datetime='2007-02-08T20:04:10+09:00'>2007-2-8</time>

</p>

</section>
</div>

</article>



<div class='explore'>
<div>
<header class='grid'>
<div class='grid'>
<a class='btn btn--link visible-xs-inline-block disabled'>
<figure>
<amp-img alt='Author Avatar' class='img-circle' layout='fill' src='/img/author_avatar.jpg'></amp-img>
</figure>
</a>
<a class='btn btn--link visible-xs-inline-block disabled'>&#8203;</a>
<a class='btn btn--link' href='https://feedly.com/i/subscription/feed/https://michilu.com/rss.xml' target='_blank'>
<span class='icon-feedly'></span>
</a>
<a class='btn btn--link visible-xs-inline-block disabled'>&#8203;</a>
<a class='btn btn--link visible-xs-inline-block disabled'>&#8203;</a>
</div>
</header>

<amp-carousel autoplay delay='3500' height='320' layout='responsive' loop type='slides' width='320'>
<div class='slide'>
<amp-img layout='fill' src='https://picsum.photos/2048.webp?random'></amp-img>
<amp-fit-text class='caption' layout='fill' min-font-size='15'></amp-fit-text>
</div>
</amp-carousel>
<div class='next'>
<amp-list height='1' layout='responsive' src='/amp-list/newer.json?RANDOM' width='320'>
<template type='amp-mustache'>
<a href='{{root_relative_url}}'>
<amp-fit-text height='152' layout='responsive' width='320'>{{title}}</amp-fit-text>
{{#image}}
<amp-img layout='fill' src='{{.}}'></amp-img>
{{/image}}
{{^image}}
<amp-img layout='fill' src='https://picsum.photos/2048.webp?{{root_relative_url}}'></amp-img>
{{/image}}
</a>
</template>
</amp-list>
</div>
</div>
</div>
<footer class='ta-center fs-small text-muted' id='copyright'>
&copy;<span>2001-</span><span id='this-year'>2020</span>&nbsp;
ツキヨミチル
</footer>
</body>
</html>